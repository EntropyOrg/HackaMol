use Modern::Perl;
use lib 'lib/HackaMol';
use Time::HiRes qw(time);
use Benchmark qw(cmpthese);
use Atom;

my $natoms = 100000; 
print "Atom-timer will time the construction of and array of  $natoms atoms to give idea about speed\n";

my $t1 = time;
my @atoms = map{
                 Atom->new(Z => 80)
               } 1 .. $natoms;

my $t2 = time;
printf ("time to Atom->new(Z => 80) for $natoms atoms: %10.3f\n", $t2-$t1);

my $t3;
foreach my $t (1 .. 10){
  $_->push_coords([2,2,2]) foreach @atoms;
  $t3 = time;
  printf ("$t time to push_coords( [2.000,2.000,2.000] ) for $natoms atoms: %10.3f\n", $t3-$t2);
  $t2 = time;
}

foreach my $t (1 .. 10){
  $atoms[$t]->push_coords([2,2,2]) foreach 1..100;
  $t3 = time;
  printf ("Time to push_coords( [2.000,2.000,2.000] ) 100 times for atom $t: %.3g\n", $t3-$t2);
  $t2 = time;
}


$_->set_coords(0,[1.000 ,1.000,1.000]) foreach @atoms;
my $t4 = time;
printf ("time to set_coords(0, [1.000 ,1.000,1.000]) for $natoms atoms: %10.3f\n", $t4-$t3);

print "dump the last atom: ", $#atoms, "\n";
print $atoms[$#atoms]->dump;

print "construction comparison benchmarks Z vs Symbol with min attributes, many attributes, min attr with 100 coordinates\n";
cmpthese (50000, {
                  'symb min    attr' => sub{my $atom = Atom->new(symbol => "HG" ) },
                  'Z    min    attr' => sub{my $atom = Atom->new(Z      =>  80  ) },
                  'Zmin push    100' => sub{
                                            my $atom = Atom->new(Z      =>  80  ) ;
                                            $atom->push_coords([1,0,3]) foreach (1 .. 100);
                                           },
                  'symb many   attr' => sub{my $atom = Atom->new(symbol => "HG", 
                                                                 mass   => 200.59,  
                                                                 charge => [2],
                                                                 coords => [[0,0,0]], 
                                                                 forces => [[0,0,0]], 
                                                                ) },
                  'Z    many   attr' => sub{my $atom = Atom->new(Z      =>  80,
                                                                 mass   => 200.59,  
                                                                 charge => [2],
                                                                 coords => [[0,0,0]],
                                                                 forces => [[0,0,0]],
                                                                ) },
                  'symb 100  coords' => sub{my $atom = Atom->new(
                                                                name   =>'something', 
                                                                coords => [
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                          ], 
                                                               symbol => "HG" ) },
                  'Z    100  coords' => sub{my $atom = Atom->new(
                                                                name   =>'something', 
                                                                coords => [
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                           [1,0,3],
                                                                          ], 
                                                               Z      =>  80 )},
                 }
         );


